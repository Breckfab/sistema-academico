

<!-- ════════════════════════════════════════════
     templates/admin_profesores.html
     IMPORTANTE: Guardar como archivo SEPARADO
════════════════════════════════════════════ -->
{# SAVE AS: templates/admin_profesores.html #}
{% extends 'base.html' %}
{% block title %}Gestión de Profesores{% endblock %}
{% block content %}
<h4 class="fw-bold mb-4" style="color:var(--navy)">
  <i class="bi bi-person-gear me-2"></i>Gestión de Profesores y Códigos
</h4>

<div class="row g-4">
  {# ── Columna izquierda ── #}
  <div class="col-md-6">
    {# Crear código #}
    <div class="card mb-4">
      <div class="card-header">
        <i class="bi bi-key me-2"></i>Generar código de registro
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('nuevo_codigo') }}">
          <div class="input-group">
            <input type="text" name="codigo" class="form-control"
                   placeholder="Ej: 1023 o PROFE2025" required>
            <button class="btn btn-navy">
              <i class="bi bi-plus-circle me-1"></i>Generar
            </button>
          </div>
          <small class="text-muted">
            El código será entregado al nuevo profesor para que se registre.
          </small>
        </form>
      </div>
    </div>

    {# Códigos existentes #}
    <div class="card">
      <div class="card-header">
        <i class="bi bi-list-check me-2"></i>Códigos emitidos
      </div>
      <div class="card-body p-0">
        <table class="table table-sm mb-0">
          <thead>
            <tr><th>Código</th><th>Estado</th><th>Creado</th></tr>
          </thead>
          <tbody>
            {% for c in codigos %}
            <tr>
              <td><code>{{ c.codigo }}</code></td>
              <td>
                {% if c.usado %}
                <span class="badge bg-secondary">Usado</span>
                {% else %}
                <span class="badge bg-success">Disponible</span>
                {% endif %}
              </td>
              <td>{{ c.creado_en.strftime('%d/%m/%Y') }}</td>
            </tr>
            {% else %}
            <tr>
              <td colspan="3" class="text-center text-muted">Sin códigos.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  {# ── Columna derecha ── #}
  <div class="col-md-6">
    {# Crear profesor manualmente #}
    <div class="card mb-4">
      <div class="card-header">
        <i class="bi bi-person-plus me-2"></i>Crear profesor manualmente
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('admin_nuevo_profesor') }}">
          <div class="row g-2 mb-2">
            <div class="col">
              <input type="text" name="nombre" class="form-control form-control-sm"
                     placeholder="Nombre" required>
            </div>
            <div class="col">
              <input type="text" name="apellido" class="form-control form-control-sm"
                     placeholder="Apellido" required>
            </div>
          </div>
          <div class="mb-2">
            <input type="text" name="username" class="form-control form-control-sm"
                   placeholder="Nombre de usuario" required>
          </div>
          <div class="mb-2">
            <input type="email" name="email" class="form-control form-control-sm"
                   placeholder="Email" required>
          </div>
          <div class="mb-2">
            <input type="text" name="password" class="form-control form-control-sm"
                   placeholder="Contraseña provisoria" required>
          </div>
          <button class="btn btn-navy btn-sm w-100">
            <i class="bi bi-person-check me-1"></i>Crear profesor
          </button>
          <small class="text-muted d-block mt-1">
            El profesor deberá cambiar su contraseña al primer acceso.
          </small>
        </form>
      </div>
    </div>

    {# Lista de profesores #}
    <div class="card">
      <div class="card-header">
        <i class="bi bi-people me-2"></i>Profesores registrados
      </div>
      <div class="card-body p-0">
        <table class="table table-sm mb-0">
          <thead>
            <tr><th>Nombre</th><th>Usuario</th><th>Estado</th><th>Acción</th></tr>
          </thead>
          <tbody>
            {% for p in profesores %}
            <tr>
              <td>{{ p.nombre_completo }}</td>
              <td><code>{{ p.username }}</code></td>
              <td>
                {% if p.activo %}
                <span class="badge bg-success">Activo</span>
                {% else %}
                <span class="badge bg-danger">Inactivo</span>
                {% endif %}
                {% if p.debe_cambiar_pass %}
                <span class="badge bg-warning text-dark ms-1">Prov.</span>
                {% endif %}
              </td>
              <td>
                <form method="POST" action="{{ url_for('toggle_profesor', uid=p.id) }}"
                      class="d-inline">
                  <button class="btn btn-sm {% if p.activo %}btn-outline-danger{% else %}btn-outline-success{% endif %}">
                    {% if p.activo %}<i class="bi bi-lock"></i>{% else %}<i class="bi bi-unlock"></i>{% endif %}
                  </button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="4" class="text-center text-muted">Sin profesores.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
